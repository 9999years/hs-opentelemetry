on:
  push:
  pull_request:
jobs:
  stack-ghc-9_0:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: cachix/install-nix-action@v17
        with:
          nix_path: nixpkgs=channel:nixos-22.05
      - uses: actions/cache@v3
        with:
          path: |
            ~/.stack
            .stack-work
          key: stack-${{ runner.os }}-${{ hashFiles('stack.yaml.lock') }}
          restore-keys: |
            stack-${{ runner.os }}
      - run: stack build --only-dependencies
      - run: stack build
      - run: stack test
  stack-ghc-9_2:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: cachix/install-nix-action@v17
        with:
          nix_path: nixpkgs=channel:nixos-22.05
      - uses: actions/cache@v3
        with:
          path: |
            ~/.stack
            .stack-work
          key: stack-${{ runner.os }}-9.2-${{ hashFiles('stack-ghc-9.2.yaml.lock') }}
          restore-keys: |
            stack-${{ runner.os }}-9.2
      - run: stack --stack-yaml stack-ghc-9.2.yaml build --only-dependencies
      - run: stack --stack-yaml stack-ghc-9.2.yaml build
      - run: stack --stack-yaml stack-ghc-9.2.yaml test
  cabal-ghc-8_10:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: cachix/install-nix-action@v17
        with:
          nix_path: nixpkgs=channel:nixos-22.05
      - uses: actions/cache@v3
        with:
          path: ~/.cabal
          key: cabal-${{ runner.os }}-8.10
      - run: cabal build --only-dependencies all
      - run: cabal build all
      - run: cabal test all
